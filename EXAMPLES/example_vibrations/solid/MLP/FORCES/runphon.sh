#!/bin/bash -l
#SBATCH --job-name="mace_md"
#SBATCH --account="s1288"
#SBATCH --time=00:30:00
#SBATCH --nodes=1
#SBATCH --ntasks-per-core=1
#SBATCH --ntasks-per-node=12
#SBATCH --cpus-per-task=1
#SBATCH --partition=debug
#SBATCH --constraint=gpu
#SBATCH --hint=nomultithread

export OMP_NUM_THREADS=$SLURM_CPUS_PER_TASK
export CRAY_CUDA_MPS=1

module load daint-gpu


source /users/fdellapi/software/mace-venv/bin/activate



which python 

rm -rf FORCES 
header=$(head -n 1 POSCAR)
cp SPOSCAR POSCAR.phon

for i in \
 "   1  0.00050125  0.00000000  0.00000000 " \ "   1  0.00000000  0.00053677  0.00000000 " \ "   1  0.00000000  0.00000000  0.00048520 " \ "  55  0.00050125  0.00000000  0.00000000 " \ "  55  0.00000000  0.00053677  0.00000000 " \ "  55  0.00000000  0.00000000  0.00048520 " \ " 109  0.00050125  0.00000000  0.00000000 " \ " 109  0.00000000  0.00053677  0.00000000 " \ " 109  0.00000000  0.00000000  0.00048520 " \ " 163  0.00050125  0.00000000  0.00000000 " \ " 163  0.00000000  0.00053677  0.00000000 " \ " 163  0.00000000  0.00000000  0.00048520 " \ " 217  0.00050125  0.00000000  0.00000000 " \ " 217  0.00000000  0.00053677  0.00000000 " \ " 217  0.00000000  0.00000000  0.00048520 " \ " 271  0.00050125  0.00000000  0.00000000 " \ " 271  0.00000000  0.00053677  0.00000000 " \ " 271  0.00000000  0.00000000  0.00048520 " \ " 325  0.00050125  0.00000000  0.00000000 " \ " 325  0.00000000  0.00053677  0.00000000 " \ " 325  0.00000000  0.00000000  0.00048520 " \ " 379  0.00050125  0.00000000  0.00000000 " \ " 379  0.00000000  0.00053677  0.00000000 " \ " 379  0.00000000  0.00000000  0.00048520 " \ " 433  0.00050125  0.00000000  0.00000000 " \ " 433  0.00000000  0.00053677  0.00000000 " \ " 433  0.00000000  0.00000000  0.00048520 " \ " 487  0.00050125  0.00000000  0.00000000 " \ " 487  0.00000000  0.00053677  0.00000000 " \ " 487  0.00000000  0.00000000  0.00048520 " \ " 541  0.00050125  0.00000000  0.00000000 " \ " 541  0.00000000  0.00053677  0.00000000 " \ " 541  0.00000000  0.00000000  0.00048520 " \ " 595  0.00050125  0.00000000  0.00000000 " \ " 595  0.00000000  0.00053677  0.00000000 " \ " 595  0.00000000  0.00000000  0.00048520 " \ " 649  0.00050125  0.00000000  0.00000000 " \ " 649  0.00000000  0.00053677  0.00000000 " \ " 649  0.00000000  0.00000000  0.00048520 " \ " 703  0.00050125  0.00000000  0.00000000 " \ " 703  0.00000000  0.00053677  0.00000000 " \ " 703  0.00000000  0.00000000  0.00048520 " \ " 757  0.00050125  0.00000000  0.00000000 " \ " 757  0.00000000  0.00053677  0.00000000 " \ " 757  0.00000000  0.00000000  0.00048520 " \ " 811  0.00050125  0.00000000  0.00000000 " \ " 811  0.00000000  0.00053677  0.00000000 " \ " 811  0.00000000  0.00000000  0.00048520 " \ "   1 -0.00050125  0.00000000  0.00000000 " \ "   1  0.00000000 -0.00053677  0.00000000 " \ "   1  0.00000000  0.00000000 -0.00048520 " \ "  55 -0.00050125  0.00000000  0.00000000 " \ "  55  0.00000000 -0.00053677  0.00000000 " \ "  55  0.00000000  0.00000000 -0.00048520 " \ " 109 -0.00050125  0.00000000  0.00000000 " \ " 109  0.00000000 -0.00053677  0.00000000 " \ " 109  0.00000000  0.00000000 -0.00048520 " \ " 163 -0.00050125  0.00000000  0.00000000 " \ " 163  0.00000000 -0.00053677  0.00000000 " \ " 163  0.00000000  0.00000000 -0.00048520 " \ " 217 -0.00050125  0.00000000  0.00000000 " \ " 217  0.00000000 -0.00053677  0.00000000 " \ " 217  0.00000000  0.00000000 -0.00048520 " \ " 271 -0.00050125  0.00000000  0.00000000 " \ " 271  0.00000000 -0.00053677  0.00000000 " \ " 271  0.00000000  0.00000000 -0.00048520 " \ " 325 -0.00050125  0.00000000  0.00000000 " \ " 325  0.00000000 -0.00053677  0.00000000 " \ " 325  0.00000000  0.00000000 -0.00048520 " \ " 379 -0.00050125  0.00000000  0.00000000 " \ " 379  0.00000000 -0.00053677  0.00000000 " \ " 379  0.00000000  0.00000000 -0.00048520 " \ " 433 -0.00050125  0.00000000  0.00000000 " \ " 433  0.00000000 -0.00053677  0.00000000 " \ " 433  0.00000000  0.00000000 -0.00048520 " \ " 487 -0.00050125  0.00000000  0.00000000 " \ " 487  0.00000000 -0.00053677  0.00000000 " \ " 487  0.00000000  0.00000000 -0.00048520 " \ " 541 -0.00050125  0.00000000  0.00000000 " \ " 541  0.00000000 -0.00053677  0.00000000 " \ " 541  0.00000000  0.00000000 -0.00048520 " \ " 595 -0.00050125  0.00000000  0.00000000 " \ " 595  0.00000000 -0.00053677  0.00000000 " \ " 595  0.00000000  0.00000000 -0.00048520 " \ " 649 -0.00050125  0.00000000  0.00000000 " \ " 649  0.00000000 -0.00053677  0.00000000 " \ " 649  0.00000000  0.00000000 -0.00048520 " \ " 703 -0.00050125  0.00000000  0.00000000 " \ " 703  0.00000000 -0.00053677  0.00000000 " \ " 703  0.00000000  0.00000000 -0.00048520 " \ " 757 -0.00050125  0.00000000  0.00000000 " \ " 757  0.00000000 -0.00053677  0.00000000 " \ " 757  0.00000000  0.00000000 -0.00048520 " \ " 811 -0.00050125  0.00000000  0.00000000 " \ " 811  0.00000000 -0.00053677  0.00000000 " \ " 811  0.00000000  0.00000000 -0.00048520 " 
do

awk '
/SUBSIT/  { npos = $2 ; 
            x=$3; y=$4 ; z=$5; }
!/SUBSIT/ { line=line+1 
  if (line-7 == npos) {
    printf "%12.9f %12.9f %12.9f\n", $1+x, $2+y, $3+z
  } 
  else if (line > 7) {
    printf "%12.9f %12.9f %12.9f\n", $1, $2, $3
  } 
  else 
    print 
} ' >POSCAR.phon <<!
SUBSIT $i
`cat SPOSCAR`
!


sed -i '5s/$/\n'"$header"'/' POSCAR.phon

python run-phon.py  $i
rm -f POSCAR.phon

done


Ndisp=`wc -l DISP | awk '{print $1}'`
sed -i "1s/^/$Ndisp\n/" FORCES

